import{EasyField as e}from"react-formutil";export*from"react-formutil";import t,{Component as r,Children as s,cloneElement as i,isValidElement as o,createContext as n,Fragment as a}from"react";import{FormControl as l,FormLabel as c,InputGroup as d,FormGroup as p,FormSelect as u,ToggleButtonGroup as m,ToggleButton as h,FormCheck as f,FloatingLabel as g,Col as v,Row as y,FormText as k}from"react-bootstrap";import b from"react-is";import E from"react-fast-compare";class P extends r{render(){const{children:e,name:t,onChange:r,value:o,onFocus:n,onBlur:a,isValid:l,isInvalid:c}=this.props;const d=e=>{const{checked:t,value:s}=e.target;const i=o||[];r(t?i.concat(s):i.filter((e=>e!==s)))};return s.map(e,(e=>{const r=e.props.value;return i(e,{isValid:l,isInvalid:c,checked:!!o&&o.indexOf(r)>-1,onChange:d,onFocus:n,onBlur:a,name:t})}))}}P.formutilType="array";var $=P;let _;try{const e=document.createElement("style");e.type="text/css";document.getElementsByTagName("head")[0].appendChild(e);_=e.sheet||e.styleSheet}catch(e){}function V(e,t){if(_){if(_.insertRule){_.insertRule(`${e} { ${t} }`,0)}else if(_.addRule){_.addRule(e,t,0)}}}const{isValidElementType:C}=b;const{Consumer:F,Provider:x}=n({});let T=1;const j=function(e){T=e};const A=l.Feedback;function B(e){if(e){const t=e.type;if(C(t)){if(t.formutilType){return t.formutilType}if(typeof t==="string"&&e.props.type){return e.props.type}}return t||e}}class N extends r{constructor(){super(...arguments);this.fields={};this.registerField=(e,t)=>t?this.fields[e]=t:delete this.fields[e];this.latestValidationProps=null;this.checkHasError=(e,t,r,s,i)=>{switch(e){case 0:return t&&r&&s;case 1:return t&&r;case 2:return t;default:return false}};this.fetchCurrentValidationProps=e=>{const t=Object.keys(this.fields).map((e=>this.fields[e].$new()));const r=t.filter((e=>e.$invalid));const s=r.length>0;const i=t.some((e=>e.$dirty));const o=t.some((e=>e.$touched));const n=t.some((e=>e.$focused));const a=r.map((t=>{const{$invalid:r,$focused:s,$touched:i,$dirty:o,$getFirstError:n}=t;const a=this.checkHasError(e,r,o,i,s);return a&&n()})).filter(Boolean);return this.getValidationProps(e,s,i,o,n,a)};this.getValidationProps=(e,r,s,i,o,n)=>{const a=this.checkHasError(e,r,s,i,o);const l={className:[this.props.className,a&&"has-error",r?"is-invalid":"is-valid",s?"is-dirty":"is-pristine",i?"is-touched":"is-untouched",o?"is-focused":"is-unfocused"].filter(Boolean).join(" ")};const c={};if(a){c.isInvalid=true}if(this.props.feedback&&!r){c.isValid=true}return{groupProps:l,validationProps:c,error:a?t.createElement(A,{type:"invalid"},Array.isArray(n)?n.map(((e,r)=>t.createElement("div",{key:r},e))):n):null}}}componentDidMount(){var e;(e=this.registerAncestorField)===null||e===void 0?void 0:e.call(this,this.props.name,this.$fieldutil)}componentWillUnmount(){var e;(e=this.registerAncestorField)===null||e===void 0?void 0:e.call(this,this.props.name,null)}render(){var r=this;const n=this.props;let{children:b,addons:P,label:_,helper:V,labelCol:C,wrapperCol:j,validationState:A,className:N,as:S,feedback:w,floatingLabel:O,extra:I,noStyle:R,errorLevel:Y=T,...G}=n;let U=j?v:a;const H=!S&&(C||j)?y:S;if(_){if(o(_)){if(C){_=i(_,{column:true,...C})}}else{_=t.createElement(c,Object.assign({column:!!C},C),_)}}let L=P?d:a;let z=P?{size:P.size}:undefined;if(P){if(P.pre){P.pre=o(P.pre)?P.pre:t.createElement(d.Text,null,P.pre)}if(P.end){P.end=o(P.end)?P.end:t.createElement(d.Text,null,P.end)}}else{P={}}if(V&&!o(V)){V=t.createElement(k,{muted:true},V)}if(!n.name){const{groupProps:e,error:r}=this.latestValidationProps=this.fetchCurrentValidationProps(Y);Promise.resolve().then((()=>{if(!E(this.latestValidationProps,this.fetchCurrentValidationProps(Y))){this.forceUpdate()}}));const s=typeof b==="function"?b():b;return t.createElement(x,{value:this.registerField},t.createElement(p,Object.assign({},G,e,{as:H}),_,t.createElement(U,j,t.createElement(L,z,P.pre,s,P.end),r||V),I))}if(G.$memo===true){G.__DIFF__={childList:b,compositionValue:this.compositionValue}}else if(Array.isArray(G.$memo)){G.$memo=G.$memo.concat(this.compositionValue)}const D=typeof b==="function"?b:s.only(b);let M=B(D);if((M===l&&D.props.as==="select"||M===u)&&D.props.multiple){M="multipleSelect"}switch(M){case f:case h:case"checkbox":case"radio":G.__TYPE__="checked";break;case"multipleSelect":G.__TYPE__="array";break;case $:case m:if(D.props.type!=="radio"){G.__TYPE__="array"}break;case"checked":case"array":case"object":case"number":case"empty":G.__TYPE__=M;break}return t.createElement(e,Object.assign({},G,{passUtil:"$fieldutil",render:e=>{const{valuePropName:s="value",changePropName:o="onChange",focusPropName:a="onFocus",blurPropName:l="onBlur"}=n;const{$fieldutil:c,[o]:d,[a]:u,[l]:m,[s]:h,...f}=e;const{$invalid:v,$dirty:y,$touched:k,$focused:b,$getFirstError:E}=c;let $;switch(G.__TYPE__){case"checked":case"checkbox":case"radio":const{checked:e=true,unchecked:t=false}=n;$={checked:h===e,onChange:r=>{const s=r&&r.target?r.target.checked:r;d(s?e:t,r)}};break;default:$={onCompositionEnd:e=>{this.isComposing=false;delete this.compositionValue;d(e)},onCompositionStart:()=>this.isComposing=true,[o]:M==="multipleSelect"?e=>{d([].slice.call(e.target.options).filter((e=>e.selected)).map((e=>e.value)),e)}:function(e){if(r.isComposing){r.compositionValue=e.target[s];r.forceUpdate()}else{for(var t=arguments.length,i=new Array(t>1?t-1:0),o=1;o<t;o++){i[o-1]=arguments[o]}d(e,...i)}},[s]:"compositionValue"in this?this.compositionValue:h,[l]:function(){if(r.isComposing){r.isComposing=false;delete r.compositionValue;d(...arguments)}return m(...arguments)},name:G.name};break}const{groupProps:C,validationProps:x,error:T}=this.getValidationProps(Y,v,y,k,b,E());$=Object.assign({[a]:u,[l]:m},$,x);const A=typeof D==="function"?D($):i(D,$);return t.createElement(F,null,(e=>{if(R){this.$fieldutil=c;this.registerAncestorField=e;return A}return t.createElement(p,Object.assign({},f,C,{as:H}),!O&&_,t.createElement(U,j,t.createElement(L,z,P.pre,O&&_?t.createElement(g,{label:_.props.children},A):A,P.end),T||V),I)}))}}))}}var S=N;V(".valid-feedback:empty,.invalid-feedback:empty","display: none !important");V(".has-error .invalid-feedback","display: block");class w extends r{render(){const{children:e,name:t,onChange:r,value:o,onFocus:n,onBlur:a,isValid:l,isInvalid:c}=this.props;const d=e=>{r(e.target.value,e)};return s.map(e,(e=>{const r=e.props.value;return i(e,{isValid:l,isInvalid:c,checked:o===r,onChange:d,onFocus:n,onBlur:a,name:t})}))}}var O=w;export{$ as CheckboxGroup,S as FormGroup,O as RadioGroup,$ as SwitchGroup,j as setErrorLevel};
