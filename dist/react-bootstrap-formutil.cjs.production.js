"use strict";Object.defineProperty(exports,"__esModule",{value:true});var e=require("react-formutil");var t=require("react");var r=require("react-bootstrap");var o=require("react-is");var s=require("react-fast-compare");function i(e){return e&&typeof e==="object"&&"default"in e?e:{default:e}}var n=i(t);var a=i(o);var l=i(s);class c extends t.Component{render(){const{children:e,name:r,onChange:o,value:s,onFocus:i,onBlur:n,isValid:a,isInvalid:l}=this.props;const c=e=>{const{checked:t,value:r}=e.target;const i=s||[];o(t?i.concat(r):i.filter((e=>e!==r)))};return t.Children.map(e,(e=>{const o=e.props.value;return t.cloneElement(e,{isValid:a,isInvalid:l,checked:!!s&&s.indexOf(o)>-1,onChange:c,onFocus:i,onBlur:n,name:r})}))}}c.formutilType="array";var u=c;let d;try{const e=document.createElement("style");e.type="text/css";document.getElementsByTagName("head")[0].appendChild(e);d=e.sheet||e.styleSheet}catch(e){}function p(e,t){if(d){if(d.insertRule){d.insertRule(`${e} { ${t} }`,0)}else if(d.addRule){d.addRule(e,t,0)}}}const{isValidElementType:m}=a["default"];const{Consumer:f,Provider:h}=t.createContext({});let v=1;const g=function(e){v=e};const y=r.FormControl.Feedback;function E(e){if(e){const t=e.type;if(m(t)){if(t.formutilType){return t.formutilType}if(typeof t==="string"&&e.props.type){return e.props.type}}return t||e}}class b extends t.Component{constructor(){super(...arguments);this.fields={};this.registerField=(e,t)=>t?this.fields[e]=t:delete this.fields[e];this.latestValidationProps=null;this.checkHasError=(e,t,r,o,s)=>{switch(e){case 0:return t&&r&&o;case 1:return t&&r;case 2:return t;default:return false}};this.fetchCurrentValidationProps=e=>{const t=Object.keys(this.fields).map((e=>this.fields[e].$new()));const r=t.filter((e=>e.$invalid));const o=r.length>0;const s=t.some((e=>e.$dirty));const i=t.some((e=>e.$touched));const n=t.some((e=>e.$focused));const a=r.map((t=>{const{$invalid:r,$focused:o,$touched:s,$dirty:i,$getFirstError:n}=t;const a=this.checkHasError(e,r,i,s,o);return a&&n()})).filter(Boolean);return this.getValidationProps(e,o,s,i,n,a)};this.getValidationProps=(e,t,r,o,s,i)=>{const a=this.checkHasError(e,t,r,o,s);const l={className:[this.props.className,a&&"has-error",t?"is-invalid":"is-valid",r?"is-dirty":"is-pristine",o?"is-touched":"is-untouched",s?"is-focused":"is-unfocused"].filter(Boolean).join(" ")};const c={};if(a){c.isInvalid=true}if(this.props.feedback&&!t){c.isValid=true}return{groupProps:l,validationProps:c,error:a?n["default"].createElement(y,{type:"invalid"},Array.isArray(i)?i.map(((e,t)=>n["default"].createElement("div",{key:t},e))):i):null}}}componentDidMount(){var e;(e=this.registerAncestorField)===null||e===void 0?void 0:e.call(this,this.props.name,this.$fieldutil)}componentWillUnmount(){var e;(e=this.registerAncestorField)===null||e===void 0?void 0:e.call(this,this.props.name,null)}render(){var o=this;const s=this.props;let{children:i,addons:a,label:c,helper:d,labelCol:p,wrapperCol:m,validationState:g,className:y,as:b,feedback:k,floatingLabel:C,extra:F,noStyle:P,errorLevel:V=v,..._}=s;let $=m?r.Col:t.Fragment;const x=!b&&(p||m)?r.Row:b;if(c){if(t.isValidElement(c)){if(p){c=t.cloneElement(c,{column:true,...p})}}else{c=n["default"].createElement(r.FormLabel,Object.assign({column:!!p},p),c)}}let T=a?r.InputGroup:t.Fragment;let j=a?{size:a.size}:undefined;if(a){if(a.pre){a.pre=t.isValidElement(a.pre)?a.pre:n["default"].createElement(r.InputGroup.Text,null,a.pre)}if(a.end){a.end=t.isValidElement(a.end)?a.end:n["default"].createElement(r.InputGroup.Text,null,a.end)}}else{a={}}if(d&&!t.isValidElement(d)){d=n["default"].createElement(r.FormText,{muted:true},d)}if(!s.name){const{groupProps:e,error:t}=this.latestValidationProps=this.fetchCurrentValidationProps(V);Promise.resolve().then((()=>{if(!l["default"](this.latestValidationProps,this.fetchCurrentValidationProps(V))){this.forceUpdate()}}));const o=typeof i==="function"?i():i;return n["default"].createElement(h,{value:this.registerField},n["default"].createElement(r.FormGroup,Object.assign({},_,e,{as:x}),c,n["default"].createElement($,m,n["default"].createElement(T,j,a.pre,o,a.end),t||d),F))}if(_.$memo===true){_.__DIFF__={childList:i,compositionValue:this.compositionValue}}else if(Array.isArray(_.$memo)){_.$memo=_.$memo.concat(this.compositionValue)}const O=typeof i==="function"?i:t.Children.only(i);let B=E(O);if((B===r.FormControl&&O.props.as==="select"||B===r.FormSelect)&&O.props.multiple){B="multipleSelect"}switch(B){case r.FormCheck:case r.ToggleButton:case"checkbox":case"radio":_.__TYPE__="checked";break;case"multipleSelect":_.__TYPE__="array";break;case u:case r.ToggleButtonGroup:if(O.props.type!=="radio"){_.__TYPE__="array"}break;case"checked":case"array":case"object":case"number":case"empty":_.__TYPE__=B;break}return n["default"].createElement(e.EasyField,Object.assign({},_,{passUtil:"$fieldutil",render:e=>{const{valuePropName:i="value",changePropName:l="onChange",focusPropName:u="onFocus",blurPropName:p="onBlur"}=s;const{$fieldutil:h,[l]:v,[u]:g,[p]:y,[i]:E,...b}=e;const{$invalid:k,$dirty:G,$touched:w,$focused:I,$getFirstError:S}=h;let A;switch(_.__TYPE__){case"checked":case"checkbox":case"radio":const{checked:e=true,unchecked:t=false}=s;A={checked:E===e,onChange:r=>{const o=r&&r.target?r.target.checked:r;v(o?e:t,r)}};break;default:A={onCompositionEnd:e=>{this.isComposing=false;delete this.compositionValue;v(e)},onCompositionStart:()=>this.isComposing=true,[l]:B==="multipleSelect"?e=>{v([].slice.call(e.target.options).filter((e=>e.selected)).map((e=>e.value)),e)}:function(e){if(o.isComposing){o.compositionValue=e.target[i];o.forceUpdate()}else{for(var t=arguments.length,r=new Array(t>1?t-1:0),s=1;s<t;s++){r[s-1]=arguments[s]}v(e,...r)}},[i]:"compositionValue"in this?this.compositionValue:E,[p]:function(){if(o.isComposing){o.isComposing=false;delete o.compositionValue;v(...arguments)}return y(...arguments)},name:_.name};break}const{groupProps:N,validationProps:L,error:R}=this.getValidationProps(V,k,G,w,I,S());A=Object.assign({[u]:g,[p]:y},A,L);const q=typeof O==="function"?O(A):t.cloneElement(O,A);return n["default"].createElement(f,null,(e=>{if(P){this.$fieldutil=h;this.registerAncestorField=e;return q}return n["default"].createElement(r.FormGroup,Object.assign({},b,N,{as:x}),!C&&c,n["default"].createElement($,m,n["default"].createElement(T,j,a.pre,C&&c?n["default"].createElement(r.FloatingLabel,{label:c.props.children},q):q,a.end),R||d),F)}))}}))}}var k=b;p(".valid-feedback:empty,.invalid-feedback:empty","display: none !important");p(".has-error .invalid-feedback","display: block");class C extends t.Component{render(){const{children:e,name:r,onChange:o,value:s,onFocus:i,onBlur:n,isValid:a,isInvalid:l}=this.props;const c=e=>{o(e.target.value,e)};return t.Children.map(e,(e=>{const o=e.props.value;return t.cloneElement(e,{isValid:a,isInvalid:l,checked:s===o,onChange:c,onFocus:i,onBlur:n,name:r})}))}}var F=C;exports.CheckboxGroup=u;exports.FormGroup=k;exports.RadioGroup=F;exports.SwitchGroup=u;exports.setErrorLevel=g;Object.keys(e).forEach((function(t){if(t!=="default"&&!exports.hasOwnProperty(t))Object.defineProperty(exports,t,{enumerable:true,get:function(){return e[t]}})}));
